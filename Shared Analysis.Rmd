---
title: "EDA Code Notebook Draft"
author: "Courtney Fitzgerald and Martinez Jean Claude"
date: "2024-10-03"
output: html_document
---
## Introduction


#### Drug overdoses in the US have been steadily increasing over the years. However the distribution of these deaths are not uniform for everyone. Certain groups, whether they be based around age, race, or gender, can be more prone than others to have a drug over dose. To better understand which groups are most at risk and for what drugs they are most likely to be impacted by we produced multiple descriptive visualizations on data taken from the National Center for Health Staitstics and specifically their National Vital Statistics System. These Data were gathered in 2019. These specific data are labeled as Table 008 on the Center for Disease Control's website. https://www.cdc.gov/nchs/hus/data-finder.htm?year=2019

## The Data

#### First we must load the data in the proper format and get a grasp of the distribution for variables of interest. We must also load in the appropriate packages to clean and analyze the data like, tidyverse and ggplot. 
```{r setup}
install.packages("tidyverse",repos = "http://cran.us.r-project.org")
library(tidyverse)
install.packages("ggplot2", repos = "http://cran.us.r-project.org")
library(ggplot2)
drug <- read_csv("drug_data.csv")
```


## Examining and Cleaning the Data

#### In order to evaluate how to best analyze the data we must familiarize ourselves with the variables and how these variables are oriented. This data set classifies drug overdose by type, and also takes into account estimations for the rate of overdose per 100,000 residents  for group listed. Demographic data, like race and sex are listed under the variable "STUB_LABEL_NUM" so we will accordingly disaggregate it and rename it to be more represntative of the variable's contents. 

```{r}

##In producing these tables, we can visualize the numerical assignment that corresponds to a given variable category. This information allows us to then clean the data set with new variables that separates race and gender, since these are grouped together. 

##This table tells us which single digit number represents the racial/sex level of the STUB_NAME variable. 
table(drug$STUB_NAME_NUM, drug$STUB_NAME)

## 4 is the number for Race and Gender, so we filtered on this to see which decimal number corresponds to each racial/gender group. 
drug_exam <- drug %>% 
  filter(STUB_NAME_NUM == 4)


##We make another table with this conclusively find the number and label correspondence. 
table(drug_exam$STUB_LABEL_NUM, drug_exam$STUB_LABEL)

##4.1 is White Males, 4.2 is Black Males, 4.3 is Native American Males, 4.4 is Asian Males, 4.5 is White Females, 4.6 is Black Females, 4.7 is Native American Females, and 4.8 is Asian Female

drug_racial <- drug %>% 
  filter(STUB_NAME_NUM == 4) %>%
  rename(Race_Gender = "STUB_LABEL_NUM") %>% 
  mutate(
     Race_Gender = case_when(
      Race_Gender == 4.1 ~ "White Male",
      Race_Gender == 4.2 ~ "Black Male",
      Race_Gender == 4.3 ~ "Native American Male",
      Race_Gender == 4.4 ~ "Asian Male",
      Race_Gender == 4.5 ~ "White Female",
      Race_Gender == 4.6 ~ "Black Female",
      Race_Gender == 4.7 ~ "Native American",
      Race_Gender == 4.8 ~ "Asian Female",
      TRUE ~ "Unknown" 
     ))


drug_RG <- drug %>% 
  filter(STUB_NAME_NUM == 4) %>%
  rename(Race_Gender = "STUB_LABEL_NUM") %>% 
  mutate(
     Race_Gender = case_when(
      Race_Gender == 4.1 ~ "White Male",
      Race_Gender == 4.2 ~ "Black Male",
      Race_Gender == 4.3 ~ "Native American Male",
      Race_Gender == 4.4 ~ "Asian Male",
      Race_Gender == 4.5 ~ "White Female",
      Race_Gender == 4.6 ~ "Black Female",
      Race_Gender == 4.7 ~ "Native American",
      Race_Gender == 4.8 ~ "Asian Female",
      TRUE ~ "Unknown" 
    )) %>% 
   mutate(
    Race = case_when(
      grepl("Black", Race_Gender) ~ "Black",
      grepl("White", Race_Gender) ~ "White",
      grepl("Native American", Race_Gender) ~ "Native American",
      grepl("Asian", Race_Gender) ~ "Asia",
      TRUE ~ "Unknown"
    )) %>% 
  mutate(
    Gender = case_when(
      grepl("Female", Race_Gender) ~ "Female",
      grepl("Male", Race_Gender) ~ "Male",
      TRUE ~ "Unknown"))
  

##To narrow our inquiry further, we will also identify what type of drug was responsible for a given overdose, with another tables 
table(drug$PANEL, drug$PANEL_NUM)

## This tells us that 0 represents all drug overdose deaths regardless of drug type, 1 represents drug overdose deaths from any opioid, 2 represents any drug overdose death from synthetic opioids, 3 represents drug overdose deaths from methadone, 4 represents drug overdose deaths from sythentic opioids besides methadone, and 5 represents drug overdose deaths from heroin, allowing us to filter accordingly to impact if the death rate estimates vary by racial/gender groups based on the type of drug causing the overdose. 


  
```

## All Racial and Gender Groups, for all Drug Overdose Types, from 1999 - 2018

```{r, echo = F}
ggplot(drug_racial, aes(x = factor(YEAR), y = ESTIMATE, fill = Race_Gender)) +
  geom_bar(stat = "identity", position = "dodge", na.rm = TRUE) +
  labs(title = "Estimates by Identity and Year",
       x = "Year",
       y = "Estimate") +
  theme_minimal() + theme(axis.text.x = element_text(angle = 90))
```

## Visualizing the Distribution


### While thee data, tells us a lot regarding the different observations witnessed. It is important to look at the distribution because it provide us with essential information about the central or average values in a dataset, helping us identify the "typical" value around which data points tend to cluster

```{r, echo = T}

## To visualize our data, we first looked at the distribution of RACE_GENDER by the estimate, to see which race and gender had the highest rate of drug overdose.
ggplot(drug_racial, aes(x = Race_Gender, y = ESTIMATE, fill = Race_Gender)) +
  geom_boxplot(na.rm = TRUE) +
  labs(title = "Distribution of Overdose Estimates by Race and Gender", 
       x = "Race and Gender", 
       y = "Estimate") +
  theme_minimal() + theme(axis.text.x = element_text(angle = 90))

## This shows that based on the median line of the boxplot, it indicated that the high rates of drug overdose amongst the different drug types seemed to be highly experienced by white males and native american male. However it seemed as though more overdose death rates come from the white male population.



## The next variable we looked at is the YEAR to showcase the distribution of how the number of overdose has changed over time. Instead of focusing on both the race and gender, we found it would be beneficial to just focus gender as the graph might be oversaturated.
ggplot(drug_RG, aes(x = factor(YEAR), y = ESTIMATE, fill = Gender)) +
  geom_boxplot(na.rm = TRUE) +
  labs(title = "Distribution of Overdose Estimates by Year", 
       x = "Year", 
       y = "Estimate") +
  theme_minimal() + theme(axis.text.x = element_text(angle = 90))

## The graph shows that a common trend for both female and male (excluding the unknown) is that as the years increased the number of drug overdose increased. While it was a subtle increase for females, the males saw a huge rise in drug overdose deaths. 



## Finally, we wanted to see the distribution of the different drug type overdose amongst the different race and genders to see which type is more prevalent.
ggplot(drug_racial, aes(x = factor(PANEL_NUM), y = ESTIMATE, fill = Race_Gender)) +
  geom_bar(stat = "identity", position = "dodge",na.rm = TRUE) +
  labs(title = "Overdose Estimates by Drug Type and Race/Gender", 
       x = "Drug Type", 
       y = "Estimate") +
  theme_minimal() + theme(axis.text.x = element_text(angle = 90))

## As we already established drug type 0 = all drug overdose deaths regardless of drug type, 1 =  drug overdose deaths from any opioid, 2 = any drug overdose death from synthetic opioids, 3 = drug overdose deaths from methadone, 4 = drug overdose deaths from synthetic opioids besides methadone, and 5 = drug overdose deaths from heroin. Knowing this information we have chosen to exclude 0 and 1 and conclude that the main cause of drug overdose based on the graph is from synthetic opioids besides methadone.


```

## Viewing Central Tendency of the Outcome Variable 

```{r, echo = F}
## To understand the information from the data, we have to understand the outcome variable which showcase the estimate for drug overdose death
mean_estimate <- mean(drug_racial$ESTIMATE, na.rm = TRUE) #4.2
median_estimate <- median(drug_racial$ESTIMATE, na.rm = TRUE) #2
std_estimate <- sd(drug_racial$ESTIMATE, na.rm = TRUE) #5.19


## These values don't really depict much information as this variable is an estimate rate and not a full value.



## To gain a better understanding of the outcome, we chose to focus on the mean of the different races and gender to see the mean of drug overdose death rate amongst the different groups as well as the standard deviation 
meanrace <- drug_RG %>%
  group_by(Race, Gender) %>%
  summarize(mean_estimate = mean(ESTIMATE, na.rm = TRUE), .groups = 'drop')

meanrace

stdrace<- drug_RG %>%
  group_by(Race, Gender) %>%
  summarize(std_dev_estimate = sd(ESTIMATE, na.rm = TRUE), .groups = 'drop')

stdrace

## These descriptive statistics provide a better gauge of our outcome variable, by looking at our mean values, we see that on overage the group with the highest rate of drug overdose are white males. Based on our standard variables, we also a lot of variability from the white male category depicting the spread of our data. This indicates that the white male category can vary depending on many different variables, year, drug type etc. Further inquiry can hone in on why these variations are present and what other factors may be causing them.
```


```{r, echo = F}

```


```{r, echo = F}
```


```{r, echo = F}
```


```{r, echo = F}

```

```{r, echo = F}


```


```{r , echo = F}

```


```{r, echo = F}

```


```{r, echo = F}

```

